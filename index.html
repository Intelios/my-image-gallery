<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Character Gallery</title>
    <style>
        /* --- Global Styles & Background --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: #333; overflow-x: hidden; }
        .bg-particles { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1; }
        .particle { position: absolute; background: rgba(255, 255, 255, 0.1); border-radius: 50%; animation: float 6s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0px) rotate(0deg); } 50% { transform: translateY(-100px) rotate(180deg); } }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; position: relative; }

        /* --- Header & Navigation --- */
        header { text-align: center; margin-bottom: 50px; color: white; position: relative; }
        h1 { font-size: 4rem; margin-bottom: 15px; text-shadow: 3px 3px 6px rgba(0,0,0,0.4); background: linear-gradient(45deg, #fff, #e0e0ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .subtitle { font-size: 1.4rem; opacity: 0.9; margin-bottom: 20px; }
        .nav-container { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
        .back-btn { background: rgba(255, 255, 255, 0.2); border: 2px solid rgba(255, 255, 255, 0.3); color: white; padding: 12px 24px; border-radius: 25px; cursor: pointer; transition: all 0.3s ease; font-size: 16px; backdrop-filter: blur(10px); display: none; }
        .back-btn:hover { background: rgba(255, 255, 255, 0.3); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        /* --- Character Grid --- */
        .character-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 40px; }
        .character-card { background: rgba(255, 255, 255, 0.15); border-radius: 20px; padding: 30px; text-align: center; cursor: pointer; transition: all 0.4s ease; backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.2); position: relative; overflow: hidden; }
        .character-card::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); transition: left 0.5s; }
        .character-card:hover::before { left: 100%; }
        .character-card:hover { transform: translateY(-10px) scale(1.02); box-shadow: 0 20px 40px rgba(0,0,0,0.3); background: rgba(255, 255, 255, 0.25); }
        .character-avatar { width: 120px; height: 120px; border-radius: 50%; margin: 0 auto 20px; background: linear-gradient(45deg, #ff6b6b, #4ecdc4); display: flex; align-items: center; justify-content: center; font-size: 3rem; color: white; box-shadow: 0 10px 30px rgba(0,0,0,0.2); position: relative; overflow: hidden; }
        .character-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .character-name { font-size: 1.8rem; font-weight: 700; color: white; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .character-description { color: rgba(255, 255, 255, 0.9); font-size: 1rem; line-height: 1.5; margin-bottom: 15px; }
        .image-count { background: rgba(255, 255, 255, 0.2); padding: 8px 16px; border-radius: 15px; color: white; font-size: 0.9rem; display: inline-block; }

        /* --- Image Gallery --- */
        .image-gallery { display: none; }
        .image-gallery.active { display: block; }
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; margin-top: 30px; }
        .image-item { position: relative; aspect-ratio: 1; overflow: hidden; border-radius: 20px; cursor: pointer; transition: all 0.4s ease; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 2px solid rgba(255, 255, 255, 0.2); }
        .image-item:hover { transform: translateY(-8px) rotate(1deg); box-shadow: 0 20px 50px rgba(0,0,0,0.4); border-color: rgba(255, 255, 255, 0.4); }
        .image-item img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.4s ease; }
        .image-item:hover img { transform: scale(1.1); }
        .image-overlay { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.9)); color: white; padding: 25px; transform: translateY(100%); transition: transform 0.4s ease; }
        .image-item:hover .image-overlay { transform: translateY(0); }
        .image-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 5px; }

        /* --- Lightbox --- */
        .lightbox { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(10px); }
        .lightbox.active { display: flex; }
        
        /* MODIFIED: The new, improved lightbox styles */
        .lightbox-content {
            max-width: calc(100vw - 160px);
            max-height: calc(100vh - 120px);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: lightboxZoom 0.3s ease;
        }
        @keyframes lightboxZoom { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .lightbox img {
            display: block;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain; /* The magic property */
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }
        
        .lightbox-close {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 35px;
            cursor: pointer;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 1002;
        }
        .lightbox-close:hover { background: rgba(255, 255, 255, 0.3); transform: scale(1.1); }

        .lightbox-nav {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 30px;
            cursor: pointer;
            width: 50px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            z-index: 1001;
            user-select: none;
        }
        .lightbox-nav:hover { background: rgba(255, 255, 255, 0.4); }
        #lightbox-prev { left: 20px; }
        #lightbox-next { right: 20px; }

        .lightbox-caption {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1rem;
            z-index: 1001;
            backdrop-filter: blur(5px);
        }

        /* --- Utility & Responsive --- */
        .gallery-message { text-align: center; color: rgba(255, 255, 255, 0.8); font-size: 1.2rem; padding: 80px 20px; background: rgba(255, 255, 255, 0.1); border-radius: 20px; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .loading-spinner { display: inline-block; width: 50px; height: 50px; border: 5px solid rgba(255,255,255,.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @media (max-width: 768px) { h1 { font-size: 2.5rem; } .character-grid { grid-template-columns: 1fr; gap: 20px; } .gallery-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; } .character-card { padding: 20px; } .character-avatar { width: 100px; height: 100px; font-size: 2.5rem; } }
    </style>
</head>
<body>
    <div class="bg-particles" id="particles"></div>
    
    <div class="container">
        <header>
            <h1 id="main-title">Character Gallery</h1>
            <p class="subtitle" id="main-subtitle">Explore my amazing characters</p>
        </header>

        <div class="nav-container">
            <button class="back-btn" id="back-btn">‚Üê Back to Characters</button>
        </div>

        <div class="character-grid" id="character-grid"></div>
        <div class="image-gallery" id="image-gallery">
            <div class="gallery-grid" id="gallery-grid"></div>
            <div class="gallery-message" id="gallery-message" style="display: none;"></div>
        </div>
    </div>

    <div class="lightbox" id="lightbox">
        <button class="lightbox-close" id="lightbox-close">√ó</button>
        <button class="lightbox-nav" id="lightbox-prev" aria-label="Previous image">‚ùÆ</button>
        <button class="lightbox-nav" id="lightbox-next" aria-label="Next image">‚ùØ</button>
        <div class="lightbox-content">
            <img id="lightbox-img" src="" alt="">
        </div>
        <div class="lightbox-caption" id="lightbox-caption"></div>
    </div>

    <script>
        const characterDatabase = {
            "daisy": {
                name: "Daisy",
                description: "A cheerful adventurer who loves to explore sunny fields and ancient ruins.",
                avatar: 'images/daisy/avatar.png' 
            },
            "zane": { name: "Zane Shadowblade", description: "A mysterious rogue with dual daggers and a troubled past.", avatar: "üó°Ô∏è" },
            "maya": { name: "Maya Stormcaller", description: "A powerful sorceress who commands lightning and thunder.", avatar: "‚ö°" },
            "kai": { name: "Kai Ironheart", description: "A noble paladin with unshakeable faith and a magical sword.", avatar: "üõ°Ô∏è" }
        };

        const characterGrid = document.getElementById('character-grid');
        const imageGallery = document.getElementById('image-gallery');
        const galleryGrid = document.getElementById('gallery-grid');
        const galleryMessage = document.getElementById('gallery-message');
        const backBtn = document.getElementById('back-btn');
        const mainTitle = document.getElementById('main-title');
        const mainSubtitle = document.getElementById('main-subtitle');
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        const lightboxClose = document.getElementById('lightbox-close');
        const lightboxPrev = document.getElementById('lightbox-prev');
        const lightboxNext = document.getElementById('lightbox-next');
        const lightboxCaption = document.getElementById('lightbox-caption');

        let currentGalleryImages = [];
        let currentImageIndex = 0;

        function init() {
            createBackgroundParticles();
            loadCharacters();
            setupEventListeners();
        }

        function createBackgroundParticles() {
            const particlesContainer = document.getElementById('particles');
            if (particlesContainer.children.length > 0) return;
            for (let i = 0; i < 15; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.width = Math.random() * 10 + 5 + 'px';
                particle.style.height = particle.style.width;
                particle.style.animationDelay = Math.random() * 6 + 's';
                particle.style.animationDuration = (Math.random() * 4 + 4) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        function setupEventListeners() {
            backBtn.addEventListener('click', showCharacters);
            lightboxClose.addEventListener('click', closeLightbox);
            lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });
            lightboxPrev.addEventListener('click', () => showLightboxImage(currentImageIndex - 1));
            lightboxNext.addEventListener('click', () => showLightboxImage(currentImageIndex + 1));
            document.addEventListener('keydown', (e) => {
                if (lightbox.classList.contains('active')) {
                    if (e.key === 'ArrowRight') showLightboxImage(currentImageIndex + 1);
                    if (e.key === 'ArrowLeft') showLightboxImage(currentImageIndex - 1);
                    if (e.key === 'Escape') closeLightbox();
                } else if (imageGallery.classList.contains('active')) {
                    if (e.key === 'Escape') showCharacters();
                }
            });
        }

        function loadCharacters() {
            characterGrid.innerHTML = '';
            Object.keys(characterDatabase).forEach(async (characterId) => {
                const character = characterDatabase[characterId];
                const card = document.createElement('div');
                card.className = 'character-card';
                card.setAttribute('data-character', characterId);
                let avatarContent = character.avatar.includes('.') ? `<img src="${character.avatar}" alt="${character.name}" onerror="this.parentElement.innerHTML = '‚ùì';">` : character.avatar;
                card.innerHTML = `<div class="character-avatar">${avatarContent}</div><div class="character-name">${character.name}</div><div class="character-description">${character.description}</div><div class="image-count" id="count-${characterId}"><div class="loading-spinner" style="width:15px; height:15px; border-width:2px;"></div></div>`;
                card.addEventListener('click', () => showCharacterGallery(characterId));
                characterGrid.appendChild(card);
                const imageCount = await countImages(characterId);
                document.getElementById(`count-${characterId}`).textContent = `${imageCount} image${imageCount !== 1 ? 's' : ''}`;
            });
        }

        function checkImage(path) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => resolve(true);
                img.onerror = () => resolve(false);
                img.src = path;
            });
        }

        async function countImages(characterId) {
            let count = 0;
            for (let i = 1; i <= 100; i++) {
                if (await checkImage(`images/${characterId}/image${i}.png`)) count++; else break;
            }
            return count;
        }

        async function showCharacterGallery(characterId) {
            const character = characterDatabase[characterId];
            mainTitle.textContent = character.name;
            mainSubtitle.textContent = character.description;
            characterGrid.style.display = 'none';
            imageGallery.classList.add('active');
            backBtn.style.display = 'block';
            galleryGrid.innerHTML = '';
            galleryGrid.style.display = 'none';
            galleryMessage.style.display = 'block';
            galleryMessage.innerHTML = '<div class="loading-spinner"></div>';
            currentGalleryImages = await findCharacterImages(characterId);
            if (currentGalleryImages.length === 0) {
                galleryMessage.innerHTML = `<p>No images found for this character yet!</p><p style="margin-top: 10px; font-size: 1rem; opacity: 0.7;">Add files like <code>image1.png</code> to the <code>/images/${characterId}/</code> folder.</p>`;
            } else {
                galleryMessage.style.display = 'none';
                galleryGrid.style.display = 'grid';
                currentGalleryImages.forEach((image, index) => galleryGrid.appendChild(createImageItem(image, index)));
            }
        }

        async function findCharacterImages(characterId) {
            const foundImages = [];
            for (let i = 1; i <= 100; i++) {
                const path = `images/${characterId}/image${i}.png`;
                if (await checkImage(path)) {
                    foundImages.push({ src: path, title: `${characterDatabase[characterId].name} - Image ${i}` });
                } else break;
            }
            return foundImages;
        }

        function showCharacters() {
            mainTitle.textContent = 'Character Gallery';
            mainSubtitle.textContent = 'Explore my amazing characters';
            characterGrid.style.display = 'grid';
            imageGallery.classList.remove('active');
            backBtn.style.display = 'none';
        }

        function createImageItem(image, index) {
            const item = document.createElement('div');
            item.className = 'image-item';
            item.innerHTML = `<img src="${image.src}" alt="${image.title}" loading="lazy" onerror="this.parentElement.style.display='none'"><div class="image-overlay"><div class="image-title">${image.title}</div></div>`;
            item.addEventListener('click', () => openLightbox(index));
            return item;
        }

        function openLightbox(index) {
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden';
            showLightboxImage(index);
        }

        function closeLightbox() {
            lightbox.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function showLightboxImage(index) {
            if (currentGalleryImages.length === 0) return;
            if (index >= currentGalleryImages.length) index = 0;
            if (index < 0) index = currentGalleryImages.length - 1;
            currentImageIndex = index;
            const image = currentGalleryImages[index];
            lightboxImg.style.opacity = 0;
            setTimeout(() => {
                lightboxImg.src = image.src;
                lightboxImg.alt = image.title;
                lightboxCaption.textContent = `${image.title} (${index + 1} / ${currentGalleryImages.length})`;
                lightboxImg.style.opacity = 1;
            }, 150);
        }
        
        lightboxImg.style.transition = 'opacity 0.15s ease-in-out';

        init();
    </script>
</body>
</html>