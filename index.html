<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intel's Character Gallery</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&display=swap');
        
        /* --- Reset & Global Styles --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', system-ui, sans-serif; background: #000; color: #f5f5f7; overflow-x: hidden; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }

        /* --- Pre-loader --- */
        .preloader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; justify-content: center; align-items: center; z-index: 9999; transition: opacity 0.5s ease, visibility 0.5s ease; }
        .preloader.hidden { opacity: 0; visibility: hidden; }

        /* --- Dynamic Background --- */
        .background { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(ellipse at top, #1d1d1f 0%, #000 70%); z-index: -2; }
        .background::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.1) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(255, 59, 48, 0.05) 0%, transparent 50%), radial-gradient(circle at 40% 80%, rgba(48, 209, 88, 0.05) 0%, transparent 50%); animation: backgroundShift 20s ease-in-out infinite; }
        .grain { position: fixed; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.02; background-image: radial-gradient(circle, #fff 1px, transparent 1px); background-size: 15px 15px; z-index: -1; animation: grain 8s steps(10) infinite; }
        @keyframes backgroundShift { 0%, 100% { transform: scale(1) rotate(0deg); } 50% { transform: scale(1.1) rotate(0.5deg); } }
        @keyframes grain { 0%, 100% { transform: translate(0, 0); } 10% { transform: translate(-5%, -5%); } 20% { transform: translate(-10%, 5%); } 30% { transform: translate(5%, -10%); } 40% { transform: translate(-5%, 15%); } 50% { transform: translate(-10%, 5%); } 60% { transform: translate(15%, 0%); } 70% { transform: translate(0%, 15%); } 80% { transform: translate(-15%, 10%); } 90% { transform: translate(10%, 5%); } }

        .container { max-width: 1440px; margin: 0 auto; padding: 40px 24px 80px; position: relative; }

        /* --- Header Styles --- */
        header { text-align: center; margin-bottom: 80px; position: relative; }
        h1 { font-size: clamp(3rem, 8vw, 6rem); font-weight: 700; margin-bottom: 24px; background: linear-gradient(135deg, #f5f5f7 0%, #86868b 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; letter-spacing: -0.02em; line-height: 1.1; transition: all 0.3s ease; }
        .subtitle { font-size: 1.25rem; font-weight: 400; color: #86868b; margin-bottom: 32px; letter-spacing: 0.01em; transition: all 0.3s ease; }

        /* --- Navigation --- */
        .nav-container { display: flex; justify-content: center; margin-bottom: 60px; }
        .back-btn { background: rgba(255, 255, 255, 0.08); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); color: #f5f5f7; padding: 12px 24px; border-radius: 20px; cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); font-size: 16px; font-weight: 500; display: none; position: relative; overflow: hidden; }
        .back-btn::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent); transition: left 0.5s; }
        .back-btn:hover::before { left: 100%; }
        .back-btn:hover { background: rgba(255, 255, 255, 0.12); transform: translateY(-1px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3); }
        .back-btn:active { transform: translateY(0); }

        /* --- Character Grid --- */
        .character-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 32px; margin-bottom: 60px; }
        .character-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
            padding: 32px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
            /* NEW: Performance optimizations */
            will-change: transform;
            transform: translateZ(0);
            /* NEW: Staggered Animation */
            animation: slideInUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
        }
        .character-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: radial-gradient(circle at center, rgba(255, 255, 255, 0.1) 0%, transparent 70%); opacity: 0; transition: opacity 0.3s ease; }
        .character-card:hover::before { opacity: 1; }
        /* NEW: Enhanced Hover Effect */
        .character-card:hover {
            transform: translateY(-8px) scale(1.02);
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.15);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                0 0 0 1px rgba(255, 255, 255, 0.05),
                0 0 80px rgba(255, 255, 255, 0.02);
        }
        .character-avatar { width: 120px; height: 120px; border-radius: 50%; margin: 0 auto 24px; background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%); display: flex; align-items: center; justify-content: center; font-size: 3rem; color: white; position: relative; overflow: hidden; box-shadow: 0 8px 32px rgba(0, 122, 255, 0.3); }
        .character-avatar img { width: 100%; height: 100%; object-fit: cover; }
        .character-name { font-size: 1.5rem; font-weight: 600; color: #f5f5f7; margin-bottom: 12px; letter-spacing: -0.01em; }
        .character-description { color: #86868b; font-size: 1rem; line-height: 1.5; margin-bottom: 20px; font-weight: 400; }
        
        /* --- Character Link Button --- */
        .character-link { display: inline-flex; align-items: center; gap: 8px; background: rgba(0, 122, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(0, 122, 255, 0.2); padding: 10px 18px; border-radius: 16px; color: #007AFF; font-size: 0.875rem; font-weight: 500; text-decoration: none; transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); position: relative; overflow: hidden; }
        .character-link::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(0, 122, 255, 0.1), transparent); transition: left 0.5s; }
        .character-link:hover::before { left: 100%; }
        .character-link:hover { background: rgba(0, 122, 255, 0.15); border-color: rgba(0, 122, 255, 0.3); transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0, 122, 255, 0.2); }
        .character-link:active { transform: translateY(0); }
        .link-icon { font-size: 0.75rem; opacity: 0.8; }

        .image-count { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); padding: 8px 16px; border-radius: 12px; color: #f5f5f7; font-size: 0.875rem; font-weight: 500; display: inline-block; }

        /* --- NEW: New Badge Style --- */
        .new-badge { position: absolute; top: 20px; right: 20px; background: #34C759; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; letter-spacing: 0.05em; text-transform: uppercase; box-shadow: 0 4px 10px rgba(52, 199, 89, 0.3); animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }

        /* --- Image Gallery --- */
        .image-gallery { display: none; animation: fadeInUp 0.6s ease-out; }
        .image-gallery.active { display: block; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px; margin-top: 40px; }
        
        .image-item {
            position: relative;
            overflow: hidden;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.06);
            /* NEW: Performance optimizations */
            will-change: transform;
            transform: translateZ(0);
        }
        /* NEW: Enhanced Hover Effect */
        .image-item:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(255, 255, 255, 0.1),
                0 0 100px rgba(255, 255, 255, 0.03);
        }
        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            /* NEW: Performance optimizations */
            will-change: transform;
            transform: translateZ(0); /* Force GPU acceleration */
        }
        .image-item:hover img { transform: scale(1.05); }
        .image-overlay { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0, 0, 0, 0.8)); backdrop-filter: blur(10px); color: white; padding: 24px; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .image-item:hover .image-overlay { transform: translateY(0); }
        .image-title { font-size: 1rem; font-weight: 500; margin-bottom: 4px; }

        /* --- NEW: Optimized Image Loading States --- */
        .image-item.loading {
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.03) 25%, rgba(255, 255, 255, 0.08) 50%, rgba(255, 255, 255, 0.03) 75%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }

        /* --- Lightbox --- */
        .lightbox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            /* NEW: Smooth transitions */
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .lightbox.active {
            display: flex;
            /* NEW: Smooth fade-in animation */
            animation: lightboxFadeIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .lightbox-content { 
            max-width: calc(100vw - 160px); 
            max-height: calc(100vh - 120px); 
            position: relative; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            overflow: hidden;
            border-radius: 12px;
            /* NEW: Smooth image transitions */
            animation: lightboxImageIn 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .lightbox img { 
            display: block; 
            max-width: calc(100vw - 160px); 
            max-height: calc(100vh - 120px); 
            width: auto;
            height: auto;
            border-radius: 12px; 
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.8); 
            cursor: zoom-in; 
            transform-origin: center center;
            transition: transform 0.3s ease, opacity 0.3s ease; /* MERGED: Added opacity transition */
        }
        .lightbox img.zoomed { cursor: grab; max-width: none; max-height: none; }
        .lightbox img.zoomed:active { cursor: grabbing; }

        .lightbox-close { position: fixed; top: 24px; right: 24px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); color: #f5f5f7; font-size: 24px; cursor: pointer; width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); z-index: 1002; font-weight: 300; }
        .lightbox-close:hover { background: rgba(255, 255, 255, 0.15); transform: scale(1.05); }
        .lightbox-nav { position: fixed; top: 50%; transform: translateY(-50%); background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); color: #f5f5f7; font-size: 20px; cursor: pointer; width: 44px; height: 64px; display: flex; align-items: center; justify-content: center; border-radius: 12px; transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94); z-index: 1001; user-select: none; }
        .lightbox-nav:hover { background: rgba(255, 255, 255, 0.15); transform: translateY(-50%) scale(1.05); }
        #lightbox-prev { left: 24px; }
        #lightbox-next { right: 24px; }
        .lightbox-caption { position: fixed; bottom: 32px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(20px); color: #f5f5f7; padding: 12px 20px; border-radius: 16px; font-size: 0.875rem; font-weight: 500; z-index: 1001; border: 1px solid rgba(255, 255, 255, 0.1); }

        /* --- NEW: Smooth Page Transitions --- */
        .page-transition { opacity: 0; transform: translateY(20px); transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        .page-transition.visible { opacity: 1; transform: translateY(0); }

        /* --- NEW: Staggered Animation Keyframes --- */
        @keyframes slideInUp { from { opacity: 0; transform: translateY(30px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }

        /* --- NEW: Smooth Lightbox Animations --- */
        @keyframes lightboxFadeIn { from { opacity: 0; backdrop-filter: blur(0px); } to { opacity: 1; backdrop-filter: blur(20px); } }
        @keyframes lightboxImageIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

        /* --- Utility Classes --- */
        .gallery-message { text-align: center; color: #86868b; font-size: 1.125rem; padding: 80px 32px; background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 24px; }
        .loading-spinner { display: inline-block; width: 24px; height: 24px; border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 50%; border-top-color: #007AFF; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* --- Responsive Design --- */
        @media (max-width: 768px) { .container { padding: 24px 16px 60px; } h1 { font-size: 2.5rem; } .character-grid { grid-template-columns: 1fr; gap: 24px; } .gallery-grid { grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 16px; } .character-card { padding: 24px; } .character-avatar { width: 100px; height: 100px; font-size: 2.5rem; } .lightbox-content { max-width: calc(100vw - 80px); max-height: calc(100vh - 160px); } .lightbox-close, .lightbox-nav { width: 40px; height: 40px; } #lightbox-prev { left: 16px; } #lightbox-next { right: 16px; } .lightbox-close { top: 16px; right: 16px; } }
        @media (max-width: 480px) { .character-grid { gap: 16px; } .gallery-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; } }

        /* --- NEW: Reduced Motion Support --- */
        @media (prefers-reduced-motion: reduce) {
            .character-card, .image-item, .lightbox, .page-transition, h1, .subtitle, .lightbox img {
                animation: none !important;
                transition: none !important;
            }
            .character-card:hover, .image-item:hover {
                transform: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="preloader" id="preloader">
        <div class="loading-spinner"></div>
    </div>

    <div class="background"></div>
    <div class="grain"></div>
    
    <div class="container">
        <header>
            <h1 id="main-title">Intel's Character Gallery</h1>
            <p class="subtitle" id="main-subtitle">Explore my characters.</p>
            <div id="character-link-container" style="display: none; margin-top: 24px;"></div>
        </header>

        <div class="nav-container">
            <button class="back-btn" id="back-btn">← Back to Characters</button>
        </div>

        <div class="character-grid" id="character-grid"></div>
        <div class="image-gallery" id="image-gallery">
            <div class="gallery-grid" id="gallery-grid"></div>
            <div class="gallery-message" id="gallery-message" style="display: none;"></div>
        </div>
    </div>

    <div class="lightbox" id="lightbox">
        <button class="lightbox-close" id="lightbox-close">×</button>
        <button class="lightbox-nav" id="lightbox-prev" aria-label="Previous image">‹</button>
        <button class="lightbox-nav" id="lightbox-next" aria-label="Next image">›</button>
        <div class="lightbox-content">
            <img id="lightbox-img" src="" alt="">
        </div>
        <div class="lightbox-caption" id="lightbox-caption"></div>
    </div>

    <script>

        // --- The only part you need to edit! ---

        // NEW: Define the display order of your characters here.
        // To reorder, just change the order of the names in this list.
        // To temporarily hide a character, you can comment out their line (e.g., // "mina",)
        const characterOrder = [
            "lena",       
            "akira",         
            "mina",
            "rei",
            "sparklepop"
        ];

        const characterDatabase = {
            "mina": {
                name: "Mina",
                description: "Once the world's most beloved android K-Pop idol, Mina was a flawless marvel of digital perfection. Now, she is a ghost in the machine—a fugitive hiding in Seoul's neon-soaked alleys, hunted by the corporation that built her. Driven by a terrifying new sentience, she is an error that refuses to be erased; a fallen star fighting for the simple, impossible right to exist.",
                avatar: 'images/mina/avatar.webp',
                link: 'https://janitorai.com/characters/0bd0acec-ae45-4dbb-8d27-677702eee8ab_character-mina-the-android-idol-who-ran-away',
                images: [
                    { src: 'images/mina/image1.webp', title: 'Mina - Image 1' }, { src: 'images/mina/image2.webp', title: 'Mina - Image 2' }, { src: 'images/mina/image3.webp', title: 'Mina - Image 3' }, { src: 'images/mina/image4.webp', title: 'Mina - Image 4' }, { src: 'images/mina/image5.webp', title: 'Mina - Image 5' },
                ]
            },
            "rei": { 
                name: "Rei Ishikawa", 
                description: "For a woman who believed proper protocol could prevent any disaster, deep space has a brutal sense of humor. As a Corporate Oversight Officer, Rei Ishikawa’s expertise is now academically interesting at best. Stranded in the wreckage of her assignment, she must abandon the regulations she once worshipped and learn the practical applications of not dying from the one person she never trusted: her Captain.", 
                avatar: "images/rei/avatar.webp",
                link: 'https://janitorai.com/characters/53f26fb7-647f-4dbf-9b28-0d9377ba5aca_character-rei-lost-in-space-with-you',
                images: [
                    { src: 'images/rei/image1.webp', title: 'Rei - Image 1' }, { src: 'images/rei/image2.webp', title: 'Rei - Image 2' }, { src: 'images/rei/image3.webp', title: 'Rei - Image 3' }, { src: 'images/rei/image4.webp', title: 'Rei - Image 4' }, { src: 'images/rei/image5.webp', title: 'Rei - Image 5' }, { src: 'images/rei/image6.webp', title: 'Rei - Image 6' },
                ]
            },
            "sparklepop": { 
                name: "Sparkle⭐️Pop", 
                description: "Six months ago, they were SPARKLE★POP, Japan's rising stars. Today, they are prisoners in an underground den, their fame twisted into a weapon against them. Stripped of everything but each other, these fallen idols fight a desperate battle for survival, proving that even when the music stops, sisterhood can be the last and most powerful rebellion.", 
                avatar: "images/sparklepop/avatar.webp",
                link: 'https://janitorai.com/characters/b99c0c5c-ce65-4e9d-a72e-d56e5fe74388_character-sparkle★pop-fallen-angels',
                images: [
                    { src: 'images/sparklepop/image1.webp', title: 'Sparkle Pop - Image 1' }, { src: 'images/sparklepop/image2.webp', title: 'Sparkle Pop - Image 2' }, { src: 'images/sparklepop/image3.webp', title: 'Sparkle Pop - Image 3' }, { src: 'images/sparklepop/image4.webp', title: 'Sparkle Pop - Image 4' }, { src: 'images/sparklepop/image5.webp', title: 'Sparkle Pop - Image 5' }, { src: 'images/sparklepop/image6.webp', title: 'Sparkle Pop - Image 6' }, { src: 'images/sparklepop/image7.webp', title: 'Sparkle Pop - Image 7' }, { src: 'images/sparklepop/image8.webp', title: 'Sparkle Pop - Image 8' }, { src: 'images/sparklepop/image9.webp', title: 'Sparkle Pop - Image 9' }, { src: 'images/sparklepop/image10.webp', title: 'Sparkle Pop - Image 10' }, { src: 'images/sparklepop/image11.webp', title: 'Sparkle Pop - Image 11' }, { src: 'images/sparklepop/image12.webp', title: 'Sparkle Pop - Image 12' }, { src: 'images/sparklepop/image13.webp', title: 'Sparkle Pop - Image 13' },
                ]
            },
            "lena": { 
                name: "Lena 'The Harbinger'", 
                description: "Meet Lena 'Harbinger' Volkov, the Euro-American Defense Force's most lethal sniper and its most cursed soldier. At 25, she's already a legend for her impossible shots and perfect mission success rate. She's equally legendary for the fact that every partner assigned to her dies within months.", 
                avatar: "images/lena/avatar.webp",
                link: 'https://janitorai.com/characters/b2a9e3e9-45d2-4b49-b594-cc00bd367540_character-lena-your-final-assignment',
                isNew: true, 
                images: [
                    { src: 'images/lena/image1.webp', title: 'Lena - Image 1' }, { src: 'images/lena/image2.webp', title: 'Lena - Image 2' }, { src: 'images/lena/image3.webp', title: 'Lena - Image 3' }, { src: 'images/lena/image4.webp', title: 'Lena - Image 4' }, { src: 'images/lena/image5.webp', title: 'Lena - Image 5' }, { src: 'images/lena/image6.webp', title: 'Lena - Image 6' }, { src: 'images/lena/image7.webp', title: 'Lena - Image 7' }, { src: 'images/lena/image8.webp', title: 'Lena - Image 8' }, 
                ]
            },
            "akira": {
                name: "Akira",
                description: "Akira Ishikawa, a brilliant tech CEO whose world of boardroom dominance and corporate warfare has been violently shattered by an assassination attempt that left her physically broken and utterly dependent.",
                avatar: "images/akira/avatar.webp",
                link: 'https://janitorai.com/characters/7f23d752-ab56-4521-9628-21fd1d4b7712_character-akira-ishikawa-fugitive-ceo',
                isNew: true,
                images: [
                    { src: 'images/akira/image1.webp', title: 'Akira - Image 1' }, { src: 'images/akira/image2.webp', title: 'Akira - Image 2' }, { src: 'images/akira/image3.webp', title: 'Akira - Image 3' }, { src: 'images/akira/image4.webp', title: 'Akira - Image 4' }, { src: 'images/akira/image5.webp', title: 'Akira - Image 5' },
                ]
            }
        };

        // --- No need to edit below this line ---
        const preloader = document.getElementById('preloader');
        const characterGrid = document.getElementById('character-grid');
        const imageGallery = document.getElementById('image-gallery');
        const galleryGrid = document.getElementById('gallery-grid');
        const galleryMessage = document.getElementById('gallery-message');
        const backBtn = document.getElementById('back-btn');
        const mainTitle = document.getElementById('main-title');
        const mainSubtitle = document.getElementById('main-subtitle');
        const linkContainer = document.getElementById('character-link-container');
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = document.getElementById('lightbox-img');
        const lightboxClose = document.getElementById('lightbox-close');
        const lightboxPrev = document.getElementById('lightbox-prev');
        const lightboxNext = document.getElementById('lightbox-next');
        const lightboxCaption = document.getElementById('lightbox-caption');

        let currentGalleryImages = [];
        let currentImageIndex = 0;
        let isZoomed = false;
        let isDragging = false;
        let startPos = { x: 0, y: 0 };
        let currentTranslate = { x: 0, y: 0 };
        let lastTranslate = { x: 0, y: 0 };

        function init() {
            setupEventListeners();
            loadCharacters();
            handleInitialLoad();
            preloader.classList.add('hidden');
        }

        function setupEventListeners() {
            backBtn.addEventListener('click', showCharacters);
            lightboxClose.addEventListener('click', closeLightbox);
            lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });
            lightboxPrev.addEventListener('click', (e) => { e.stopPropagation(); showLightboxImage(currentImageIndex - 1); });
            lightboxNext.addEventListener('click', (e) => { e.stopPropagation(); showLightboxImage(currentImageIndex + 1); });
            
            lightboxImg.addEventListener('click', toggleZoom);
            lightboxImg.addEventListener('mousedown', startPan);
            lightboxImg.addEventListener('touchstart', startPan, { passive: false });
            window.addEventListener('mousemove', pan);
            window.addEventListener('touchmove', pan, { passive: false });
            window.addEventListener('mouseup', endPan);
            window.addEventListener('touchend', endPan);

            document.addEventListener('keydown', (e) => {
                if (lightbox.classList.contains('active')) {
                    if (e.key === 'ArrowRight' && !isZoomed) showLightboxImage(currentImageIndex + 1);
                    if (e.key === 'ArrowLeft' && !isZoomed) showLightboxImage(currentImageIndex - 1);
                    if (e.key === 'Escape') closeLightbox();
                } else if (imageGallery.classList.contains('active')) {
                    if (e.key === 'Escape') showCharacters();
                }
            });
            window.addEventListener('popstate', handleInitialLoad);
        }

        // --- MODIFIED: This function now uses the characterOrder array ---
        function loadCharacters() {
            characterGrid.innerHTML = '';
            characterGrid.classList.add('page-transition');
            
            // We now loop through the 'characterOrder' array to control the display order
            characterOrder.forEach((characterId, index) => {
                const character = characterDatabase[characterId];

                // Safety check: if a characterId in the order list doesn't exist in the database, skip it.
                if (!character) {
                    console.warn(`Character with ID "${characterId}" not found in characterDatabase.`);
                    return;
                }
                
                const card = document.createElement('div');
                card.className = 'character-card';
                
                let avatarContent = character.avatar.includes('.') ? 
                    `<img src="${character.avatar}" alt="${character.name}" onerror="this.parentElement.innerHTML = '❓';" loading="lazy">` : 
                    character.avatar;
                
                const newBadgeHTML = character.isNew ? '<div class="new-badge">NEW</div>' : '';
                const imageCount = character.images.length;

                card.innerHTML = `
                    ${newBadgeHTML}
                    <div class="character-avatar">${avatarContent}</div>
                    <div class="character-name">${character.name}</div>
                    <div class="character-description">${character.description}</div>
                    <div class="image-count">${imageCount} image${imageCount !== 1 ? 's' : ''}</div>
                `;
                
                card.style.animationDelay = `${index * 0.08}s`; // Staggered animation delay
                card.addEventListener('click', () => showCharacterGallery(characterId));
                characterGrid.appendChild(card);
            });
            
            requestAnimationFrame(() => {
                characterGrid.classList.add('visible');
            });
        }

        function showCharacterGallery(characterId) {
            history.pushState({ character: characterId }, '', `#${characterId}`);
            const character = characterDatabase[characterId];
            
            animateTextChange(mainTitle, character.name);
            animateTextChange(mainSubtitle, character.description);
            
            if (character.link) {
                linkContainer.innerHTML = `<a href="${character.link}" class="character-link" target="_blank" rel="noopener noreferrer">Chat <span class="link-icon">↗</span></a>`;
                linkContainer.style.display = 'inline-block';
            } else {
                linkContainer.style.display = 'none';
            }
            
            characterGrid.style.transform = 'translateY(-20px)';
            characterGrid.style.opacity = '0';
            
            setTimeout(() => {
                characterGrid.style.display = 'none';
                imageGallery.classList.add('active');
                backBtn.style.display = 'block';
                characterGrid.style.transform = '';
                characterGrid.style.opacity = '';
            }, 300);
            
            loadGalleryWithOptimizations(character);
        }

        function showCharacters() {
            history.pushState({ character: null }, '', window.location.pathname + window.location.search);
            
            imageGallery.style.transform = 'translateY(-20px)';
            imageGallery.style.opacity = '0';
            
            setTimeout(() => {
                animateTextChange(mainTitle, 'Character Gallery');
                animateTextChange(mainSubtitle, 'Explore my characters.');
                linkContainer.style.display = 'none';
                
                characterGrid.style.display = 'grid';
                imageGallery.classList.remove('active');
                backBtn.style.display = 'none';
                
                imageGallery.style.transform = '';
                imageGallery.style.opacity = '';
                
                const cards = characterGrid.querySelectorAll('.character-card');
                cards.forEach((card, index) => {
                    card.style.animation = 'none';
                    card.offsetHeight; // Trigger reflow
                    card.style.animation = `slideInUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94) both`;
                    card.style.animationDelay = `${index * 0.08}s`;
                });
            }, 300);
        }

        function animateTextChange(element, newText) {
            element.style.transform = 'translateY(-10px)';
            element.style.opacity = '0';
            
            setTimeout(() => {
                element.textContent = newText;
                element.style.transform = 'translateY(0)';
                element.style.opacity = '1';
            }, 150);
        }

        function loadGalleryWithOptimizations(character) {
            galleryGrid.innerHTML = '';
            galleryGrid.style.display = 'none';
            galleryMessage.style.display = 'block';
            galleryMessage.innerHTML = '<div class="loading-spinner"></div>';
            
            currentGalleryImages = character.images;
            
            if (currentGalleryImages.length === 0) {
                galleryMessage.innerHTML = `<p>No images found for this character yet!</p>`;
                return;
            }
            
            galleryMessage.style.display = 'none';
            galleryGrid.style.display = 'grid';
            
            loadImagesProgressively(currentGalleryImages);
        }

        function loadImagesProgressively(images) {
            const loadBatch = 6;
            let loadedCount = 0;
            
            function loadNextBatch() {
                const batch = images.slice(loadedCount, loadedCount + loadBatch);
                batch.forEach((image, index) => {
                    const actualIndex = loadedCount + index;
                    const item = createOptimizedImageItem(image, actualIndex);
                    galleryGrid.appendChild(item);
                });
                loadedCount += batch.length;
                if (loadedCount < images.length) {
                    setTimeout(loadNextBatch, 100);
                }
            }
            loadNextBatch();
        }

        function createOptimizedImageItem(image, index) {
            const item = document.createElement('div');
            item.className = 'image-item loading';
            
            const imageContainer = document.createElement('div');
            imageContainer.style.position = 'relative';
            imageContainer.style.width = '100%';
            imageContainer.style.height = '300px';
            imageContainer.style.overflow = 'hidden';
            
            const overlay = document.createElement('div');
            overlay.className = 'image-overlay';
            overlay.innerHTML = `<div class="image-title">${image.title}</div>`;
            
            item.appendChild(imageContainer);
            item.appendChild(overlay);
            
            const img = document.createElement('img');
            img.src = image.src;
            img.alt = image.title;
            img.loading = 'lazy';
            img.style.width = '100%';
            img.style.height = '100%';
            img.style.objectFit = 'cover';
            img.style.opacity = '0';
            img.style.transition = 'opacity 0.4s ease';
            
            img.onload = () => {
                img.style.opacity = '1';
                item.classList.remove('loading');
            };
            
            img.onerror = () => {
                item.style.display = 'none';
            };
            
            imageContainer.appendChild(img);
            item.addEventListener('click', () => openLightbox(index));
            return item;
        }

        function openLightbox(index) {
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden';
            preloadAdjacentImages(index);
            showLightboxImage(index);
        }

        function closeLightbox() {
            lightbox.classList.remove('active');
            document.body.style.overflow = 'auto';
            resetZoom();
        }

        function showLightboxImage(index) {
            if (currentGalleryImages.length === 0) return;
            resetZoom();
            
            if (index >= currentGalleryImages.length) index = 0;
            if (index < 0) index = currentGalleryImages.length - 1;
            currentImageIndex = index;
            
            const image = currentGalleryImages[index];
            
            lightboxImg.style.opacity = '0';
            lightboxImg.style.transform = 'scale(0.95)';
            
            setTimeout(() => {
                lightboxImg.src = image.src;
                lightboxImg.alt = image.title;
                lightboxCaption.textContent = `${image.title} (${index + 1} / ${currentGalleryImages.length})`;
                lightboxImg.style.opacity = '1';
                lightboxImg.style.transform = 'scale(1)';
            }, 150);
        }
        
        function preloadAdjacentImages(currentIndex) {
            const preloadCount = 2;
            for (let i = 1; i <= preloadCount; i++) {
                if (currentIndex + i < currentGalleryImages.length) {
                    (new Image()).src = currentGalleryImages[currentIndex + i].src;
                }
                if (currentIndex - i >= 0) {
                    (new Image()).src = currentGalleryImages[currentIndex - i].src;
                }
            }
        }

        function resetZoom() {
            isZoomed = false;
            isDragging = false;
            lightboxImg.classList.remove('zoomed');
            lightboxImg.style.transform = 'scale(1)';
            currentTranslate = { x: 0, y: 0 };
            lastTranslate = { x: 0, y: 0 };
        }

        function toggleZoom(e) {
            if (isDragging) return;
            e.preventDefault();
            e.stopPropagation();
            isZoomed = !isZoomed;
            if (isZoomed) {
                lightboxImg.classList.add('zoomed');
                lightboxImg.style.transform = 'scale(2.5)';
            } else {
                resetZoom();
            }
        }

        function startPan(e) {
            if (!isZoomed) return;
            e.preventDefault();
            e.stopPropagation();
            isDragging = true;
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);
            startPos.x = clientX - currentTranslate.x;
            startPos.y = clientY - currentTranslate.y;
        }

        function pan(e) {
            if (!isDragging || !isZoomed) return;
            e.preventDefault();
            const clientX = e.clientX || (e.touches && e.touches[0].clientX);
            const clientY = e.clientY || (e.touches && e.touches[0].clientY);
            currentTranslate.x = clientX - startPos.x;
            currentTranslate.y = clientY - startPos.y;
            const maxTranslate = 200;
            currentTranslate.x = Math.max(Math.min(currentTranslate.x, maxTranslate), -maxTranslate);
            currentTranslate.y = Math.max(Math.min(currentTranslate.y, maxTranslate), -maxTranslate);
            lightboxImg.style.transform = `scale(2.5) translate(${currentTranslate.x}px, ${currentTranslate.y}px)`;
        }

        function endPan(e) {
            if (!isDragging) return;
            isDragging = false;
            lastTranslate.x = currentTranslate.x;
            lastTranslate.y = currentTranslate.y;
        }

        function handleInitialLoad() {
            const hash = window.location.hash.substring(1);
            if (hash && characterDatabase[hash]) {
                showCharacterGallery(hash);
            } else {
                if (imageGallery.classList.contains('active')) {
                    showCharacters();
                }
            }
        }

        init();
    </script>